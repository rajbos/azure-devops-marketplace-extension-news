name: 'character to run'
description: 'a description'

# Were we can define the inputs that our action will accept
inputs:
  characters: 
    required: true
  artifactName:
    required: true
  TwitterConsumerAPIKey:
    required: true
    default: 'TwitterConsumerAPIKey'
  TwitterConsumerAPISecretKey:
    required: true
    default: 'TwitterConsumerAPISecretKey'
  TwitterAccessToken:
    required: true
    default: 'TwitterAccessToken'
  TwitterAccessTokenSecret:
    required: true
    default: 'TwitterAccessTokenSecret'
  BLOB_SAS_TOKEN:
    required: true
    default: 'BLOB_SAS_TOKEN'

runs:
  using: "composite"
  # Defining the action steps(Just one step to be simple)
  steps:
    - name: Download artifact from build job
      uses: actions/download-artifact@v3
      with:
        name: ${{ inputs.artifactName }}
        path: ./ArtifactFolder

    - name: 'Show folder structure'
      shell: bash
      run: ls

    - name: App Settings Variable Substitution
      uses: microsoft/variable-substitution@v1
      with:
        files: 'ArtifactFolder/appsettings.json'
      env:
        TwitterConsumerAPIKey: ${{ inputs.TwitterConsumerAPIKey }}
        TwitterConsumerAPISecretKey: ${{ inputs.TwitterConsumerAPISecretKey }}
        TwitterAccessToken: ${{ inputs.TwitterAccessToken }}
        TwitterAccessTokenSecret: ${{ inputs.TwitterAccessTokenSecret }}
        BLOB_SAS_TOKEN: ${{ inputs.BLOB_SAS_TOKEN }}

    - name: Perform a Pester test from the command-line
      shell: pwsh
      run: |
        cd "ArtifactFolder"
        dotnet .\GitHubActionsNews.dll ${{ inputs.characters }}
